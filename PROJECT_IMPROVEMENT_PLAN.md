# Language Learning App Backend 개선 제안서 (v2.5.0 기준)

## 1) 현재 상태 진단

제공된 완료 보고서 기준으로 기능 범위는 매우 넓고(55개 엔드포인트), 제품 컨셉(모국어 수준 동기화, 도메인 필터링, 청킹/SRS 차별화)은 명확합니다.

다만 실제 운영 관점에서는 아래 4가지가 가장 큰 리스크입니다.

1. **테스트 공백**: 단위/통합/부하/E2E 테스트가 미완료
2. **운영 필수요소 미연동**: 결제/인증/스토리지/에러 추적/캐싱 미완료
3. **신뢰성 지표 부재**: SLA/SLO, API 품질 지표, 모델 성능 회귀 관리 부재
4. **문서·계약 불완전**: OpenAPI, 운영 핸드북, 장애 대응 절차 미흡

---

## 2) 우선순위 개선안 (실행 순서)

## P0 (즉시) — “런칭 블로커” 제거

### A. 인증/인가 최소 보안선 구축
- JWT 발급/갱신/폐기(블랙리스트 또는 짧은 만료+리프레시 전략)
- 사용자별 리소스 접근 검증(수평 권한상승 방지)
- Rate limiting(특히 chat/analyze, learning/extract-chunks)

### B. 데이터 계약 고정
- 모든 엔드포인트에 대해 request/response 스키마 확정
- OpenAPI 자동생성 + CI에서 schema drift 검사
- 에러 응답 포맷 표준화 (`code`, `message`, `trace_id`)

### C. 테스트 최소선
- 서비스 레이어 핵심 로직 단위 테스트
- “핵심 여정” 통합 테스트 3개
  - 온보딩 분석 → 레벨 리빌
  - 문장 추천 → 채팅 분석 → SRS 카드 생성
  - 갭 리포트 → 대시보드 반영

---

## P1 (1주 내) — “운영 가능” 상태 만들기

### D. 관측성(Observability)
- 구조화 로그(JSON), request_id/trace_id 전파
- 핵심 메트릭: p95 latency, error rate, token usage, 추천 채택률
- Sentry 연동 + 알림 임계값 설정

### E. 비동기 처리 정리
- import/analysis 계열은 큐 기반 비동기 처리로 분리
- 작업 상태 전이 명확화: `queued/running/succeeded/failed`
- 멱등 키(idempotency key) 지원(중복 업로드/재시도 대응)

### F. DB/캐시 튜닝
- 자주 조회되는 대시보드·리포트 read model 분리 고려
- 인덱스 점검(사용자+시간, 사용자+도메인, 카드 due 시점)
- Redis 캐시 TTL 전략 수립(대시보드/추천)

---

## P2 (2~4주) — “품질/성장” 가속

### G. ML/LLM 품질관리 루프
- 오프라인 평가셋 구축(도메인 감지, CEFR 추정, 추천 적합도)
- 프롬프트/모델 버전 고정 및 A/B 실험 체계
- 회귀 테스트(기준 점수 이하 시 배포 차단)

### H. 결제/권한 경계 명확화
- Stripe webhook 서명 검증 + 재처리 안전성
- Free/Premium 기능 게이트 중앙화(중복 구현 제거)
- 구독 상태 변경 이벤트 기반 동기화

### I. 보안/개인정보
- 업로드 원문 암호화 저장(또는 최소보관 정책)
- PII 마스킹 로깅
- 삭제권(계정/대화 원문) API 및 백그라운드 영구삭제 작업

---

## 3) “핵심 컨셉” 유지하면서 성능 높이는 제품 개선

1. **도메인 필터링 설명 가능성**
   - “왜 이 도메인을 제외했는지” 근거(빈도/최근성/사용상황) 노출
2. **학습 효율 지표 신뢰도 보강**
   - “4x 효율” 산식 공개 + 사용자별 근거 데이터 연결
3. **Gap 기반 추천 정확도 개선**
   - writing_only/speaking_only 판정에 confidence score 도입
4. **실시간 UX 안정화**
   - SSE 끊김 복구(reconnect/backoff/last-event-id) 클라이언트 계약 명문화

---

## 4) 바로 실행 가능한 “첫 주” 작업 백로그

- [ ] OpenAPI 문서 자동생성 및 `/docs` 품질 점검
- [ ] 표준 에러 모델 통합
- [ ] 핵심 API 10개 계약 테스트 작성
- [ ] JWT + 리프레시 토큰 + 권한체크 미들웨어
- [ ] Sentry + 구조화 로그 + trace_id
- [ ] import/analysis 작업 큐 분리(실패 재시도 포함)
- [ ] 성능 기준선 측정(k6/Locust): p50/p95, 에러율

---

## 5) 제가 수정 진행하려면 필요한 확인사항 (질문)

코드가 현재 저장소에 보이지 않아 실제 API/서비스 파일을 직접 수정할 수 없는 상태입니다.
다음 정보를 주시면 바로 코드 레벨로 개선 작업(테스트/보안/문서/운영)까지 진행하겠습니다.

1. 실제 백엔드 코드 위치가 맞나요?
   - 현재 저장소(`/workspace/app`)에는 앱 코드가 없고 `.gitkeep`만 있습니다.
2. 우선순위 선택
   - A안: 보안/인증(JWT, 권한체크) 먼저
   - B안: 테스트(핵심 여정 통합테스트) 먼저
   - C안: OpenAPI/에러표준/관측성 먼저
3. DB/큐 현재 스택 확정
   - PostgreSQL + Redis + (Celery/RQ/Arq 중 무엇인지)
4. 배포 환경
   - 단일 VM, ECS, Kubernetes 중 어떤 환경인지

확인받는 즉시, 실제 코드 기준으로 PR 단위(작게 쪼개서)로 진행하겠습니다.
